\documentclass[twoside,a4paper,12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[colorlinks,
  citecolor=black,linkcolor=black,urlcolor=black]{hyperref}
\usepackage{enumitem}
\usepackage{url}
\usepackage{listings}
\usepackage{pstricks}
\usepackage{pgfplots}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}

\usepackage{natbib} % bibtex

\usepackage{multicol}
\usepackage[hmargin={.12\paperwidth,.18\paperwidth},
  vmargin=.18\paperwidth,headheight=15pt]{geometry}

% Entêtes et pieds de page
\usepackage{fancyhdr}
% Configuration des en-têtes et pieds-de-page : tiré du User Guide
\fancyhead{} % clear all header fields
\fancyhead[RO,LE]{\bfseries Polytech Tours DI 3A}
\fancyhead[LO,RE]{\bfseries DB Practical Work}
\fancyfoot{} % clear all footer fields
\fancyfoot[RO,LE]{\thepage}
% Par défaut, on utilise le style fancy
\pagestyle{fancy}
% Pour la page de garde, on redéfinit le style plain
\fancypagestyle{plain}{%
  \fancyhf{} % clear all header and footer fields
  \fancyfoot[RO,LE]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}}

\usepackage[english]{babel}

\newenvironment{foreignpar}[1][english]{%
    \em\selectlanguage{#1}%
}{}
\newcommand*{\foreign}[2][english]{%
    \emph{\foreignlanguage{#1}{#2}}%
}

\title{DB Practical Work 1:\\The User model}

\date{\today}

\begin{document}

\maketitle

%% RESUME -----------------------------------------------------------------
\begin{abstract}
  The following subject aims at implementing the data handling for users in a twitter-like web-application. Implementations are to be done in the file \texttt{model/user.php}
\end{abstract}

\tableofcontents

\clearpage

\section{The User entity}

\subsection{Presentation}
The User entity represents a user and its properties:

\begin{itemize}
\item its login username (used in URLs and during identification)
\item its displayed name (which is a name to be displayed in the application
\item its hashed password (for identification)
\item its email
\item its avatar (or profile picture)
\end{itemize}

\subsection{\texttt{create(\$username, \$name, \$password, \$email, \$avatar\_path)}}

This function inserts a user in database. \textit{It is to be noted that the password must be hashed (see \texttt{hash\_password(\$password)})}

The function returns either the id of the newly inserted user. If there was a problem during the insertion, The \texttt{null} value is returned.

It doesn't check whether the username is already taken or not.

In the functions, you can access to the PDO object by using the following instruction:

\begin{verbatim}
$db = Db::dbc();
\end{verbatim}

\subsection{\texttt{get(\$id)}}
This function gets a post with a given id (the one given in parameter).

The application asks for a particular output: \texttt{get(\$id)} must return a stdClass PHP object. Such an object can be declared as follows:

\begin{verbatim}
$o = (object) array(
	"attribute" => "value"
);
\end{verbatim}

In the case of our User entity, an object will be owning the following attributes:

\begin{verbatim}
$o = (object) array(
    "id" => 1337,
    "username" => "yrlgtm",
    "name" => "User 1",
    "password" => "hashed",
    "email" => "yrlgtm@gmail.com",
    "avatar" => "images/sddfvjdfvj.png" 
);
\end{verbatim}

\subsection{\texttt{modify(\$uid, \$username, \$name, \$email)}}
This function updates a user whose id is \texttt{\$uid}. It doesn't check whether the new username is already taken or not. It returns a boolean which gives the state of the query.

\subsection{\texttt{change\_password(\$uid, \$new\_password)}}
This function updates only a user's password. This function hashes the new password. It returns a boolean.

\subsection{\texttt{change\_avatar(\$uid, \$avatar\_path)}}
This function changes the avatar of the user. The provided path is a temporary path and therefore the file has to be saved somewhere else. Returns a boolean.

\subsection{\texttt{destroy(\$id)}}
This function deletes a user entry. It returns a boolean.

\subsection{\texttt{search(\$string)}}
This function searches for users by query on both username and displayed name.

\subsection{\texttt{list\_all()}}
This function returns an array of every users objects (same return format as in \texttt{get(\$id)}).

\subsection{\texttt{get\_by\_username(\$username)}}
This function returns a user matching the given username (same return format as in \texttt{get(\$id)}). Returns null if no user were found.

\subsection{\texttt{check\_auth(\$username, \$password)}}
Tries to authenticate a username with a given password. Returns the user object (same return format as in \texttt{get(\$id)}) if everything went fine. Returns \texttt{null} else. \textit{This function \textbf{does} need to hash the password}

\subsection{\texttt{check\_auth\_id(\$id, \$password)}}
Tries to authenticate a user id with a given password. Returns the user object (same return format as in \texttt{get(\$id)}) if everything went fine. Returns \texttt{null} else. \textit{This function \textbf{doesn't} need to hash the password}

\section{Following users}

\subsection{Presentation}
Users can follow each others. Following someone enables a user to receive in their timeline the other user's posts.

\begin{itemize}
\item A user's followers are the users following him/her
\item A user's following are the users he/she follows
\end{itemize}

\subsection{\texttt{follow(\$id, \$id\_to\_follow)}}
This function creates a "follow" association between two users. Returns a boolean.

\subsection{\texttt{unfollow(\$id, \$id\_to\_unfollow)}}
This function deletes a "follow" association between two users. Returns a boolean.

\subsection{\texttt{get\_followers(\$uid)}}
This function returns an array of objects for every users that follow a given user.

\subsection{\texttt{get\_followings(\$uid)}}
This function returns an array of objects for every users that a given user follows.

\end{document}
